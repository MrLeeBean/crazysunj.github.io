---
title: 代理模式
date: 2016-12-29 13:24:51
tags: [Android,Java,代理模式]
toc: true
---

## 简介
1. 定义
给某一个对象提供一个代理，并由代理对象控制对原对象的引用。
2. 角色
	* ISubject：抽象主题角色，是一个接口。该接口是对象和它的代理共用的接口。
	* RealSubject：真实主题角色，是实现抽象主题接口的类。
	* Proxy：代理角色，内部含有对真实对象RealSubject的引用，从而可以操作真实对象。代理对象提供与真实对象相同的接口，以便在任何时刻都能代替真实对象。同时，代理对象可以在执行真实对象操作时，附加其他的操作，相当于对真实对象进行封装。

## 例子
例子：小明想要租房。

实现代码

```
public class XiaoMing{
	public void renting(){
		System.out.println("租房子");
	}
}
```
找了很久找不到，于是找到了中介
实现代码

```
public class Proxy{
	private XiaoMing xm;
	public Proxy(){
		xm=new XiaoMing();
	}
	public void renting(){
		xm.rennting();
	}
}
```
统一管理行为，利用接口，XiaoMing与Proxy分别实现Rent接口

Rent接口如下

```
public interface Rent {
    void renting();
}
```
<!--more-->
## 分类
### 三大代理

**远程代理**

远程代理可以作为另一个JVM上对象的本地代表。调用代理的放大，会被代理利用网络转发到远程执行，并且结果会通过网络返回给代理，再由代理将结果转给客户。

这个比较好理解，只不过是把真实对象放在远程，然后通过代理调用远程对象。

实现方式：

* Java: RMI(Remote Method Invocation)
* Android: AIDL(Android Interface Definition Language)

**虚拟代理**（一般用于控制访问创建开销大的资源）

虚拟代理作为创建开销大的对象的代表。虚拟代理经常直到我们真正需要一个对象的时候才创建它。当对象在创建前和创建中时，由虚拟代理来扮演对象的替身。对象创建后，代理就会请求直接委托给对象。

例子：图像加载。

**保护代理**

一般用动态代理实现保护代理，动态代理就是在运行时动态地创建一个代理类，实现一个或者多个接口，并将方法的调用转发到你所指定的类。因为实际的代理类是在运行时创建的。

例子：信息数据修改。

### 代理的变体

**防火墙代理**

控制网络资源的访问，保护主体免于“坏客户”的侵害。

例子：防火墙系统。

**智能引用代理**

当主题被引用时，进行额外的动作，例如计算一个对象被引用的次数。

例子：数字图书馆。

**缓存代理**

为开销大的运算结果提供暂时存储：它也允许多个客户共享结果，以减少计算或者网络延迟。

例子：Web服务器代理，以及内容管理与出版系统。

**同步代理**

在多线程的情况下为主题提供安全的访问。

例子：javaspaces，为分散式环境内的潜在对象集合提供同步访问控制。

**复杂隐藏代理**

用来隐藏一个类的复杂集合的复杂度，并进行访问控制。有时候也称为外观代理，这不难理解。复杂隐藏代理和外观模式是不一样的，因为代理控制访问，而外观模式只提供另一组接口。

**写入时复制代理**

用来控制对象的复制，方法是延迟对象的复制，直到客户真的需要为止。这是虚拟代理的变体。

例子：CopyOnWriteArrayList。